# 前端页面设计文档

## 一、概述

### 1.1 技术栈

- **前端框架**: React 19
- **UI 组件库**: Ant Design Pro v6
- **状态管理**: UmiJS Model
- **路由**: UmiJS Routes
- **请求库**: UmiJS Request (基于 Axios)

### 1.2 页面清单

| 页面路径 | 页面名称 | 权限要求 |
|---------|---------|---------|
| /shop/list | 店铺管理 | 所有用户 |
| /shop/tree | 店铺树形视图 | 总部管理员 |

---

## 二、店铺管理页面

### 2.1 页面路径

`/shop/list`

### 2.2 权限要求

所有用户可访问，但数据范围受权限控制：
- 超级管理员：查看所有店铺
- 总部管理员：查看总部+所有分店
- 分店管理员：只查看自己的店铺

### 2.3 页面布局

```
┌─────────────────────────────────────────────────────┐
│ 店铺管理                                              │
├─────────────────────────────────────────────────────┤
│ [搜索框: 店铺名称] [类型] [状态] [搜索] [+ 新建店铺]  │
├─────────────────────────────────────────────────────┤
│ 店铺编码 │ 店铺名称 │ 类型 │ 地址 │ 状态 │ 操作      │
│─────────┼─────────┼─────┼─────┼─────┼──────────│
│ SHOP..   │ 星巴克总部│ 总部 │ 北京 │ 营业 │ 查看编辑删除│
│ SHOP..   │ 朝阳门店 │ 分店 │ 北京 │ 营业 │ 查看编辑删除│
└─────────────────────────────────────────────────────┘
```

### 2.4 功能列表

#### 2.4.1 列表展示

**表格列：**
- 店铺编码
- 店铺名称
- 店铺类型（单店/连锁总部/连锁分店）
- 省市区
- 详细地址
- 联系人
- 联系电话
- 营业时间
- 状态（营业/停业）
- 创建时间
- 操作（查看、编辑、删除、查看分店）

**功能：**
- 分页展示
- 按店铺名称模糊搜索
- 按店铺类型筛选
- 按状态筛选
- 如果是总部店铺，显示"查看分店"按钮

#### 2.4.2 新建店铺弹窗

**表单字段：**

**基本信息：**
- 店铺名称（必填）
- 店铺类型（必填，单选：单店/连锁分店）
- 如果是分店，需要选择所属总部（下拉选择）

**地址信息：**
- 省份（级联选择）
- 城市（级联选择）
- 区县（级联选择）
- 详细地址
- 经纬度（地图选点）

**联系信息：**
- 联系人
- 联系电话

**营业信息：**
- 营业时间（时间范围选择器，格式：09:00-21:00）
- 店铺Logo（图片上传）
- 店铺图片（多图上传）
- 店铺描述（富文本编辑器）

**按钮：**
- 取消
- 确定

#### 2.4.3 编辑店铺弹窗

同新建弹窗，但店铺编码和店铺类型不可修改

#### 2.4.4 删除店铺

- 点击删除按钮
- 弹出二次确认对话框
- 如果是总部店铺，检查是否有分店
- 如有分店，提示"请先删除所有分店"
- 确认后执行删除（逻辑删除）

#### 2.4.5 查看分店

- 仅总部店铺显示此按钮
- 点击后跳转到分店列表页面
- 显示该总部下的所有分店

---

## 三、店铺切换组件

### 3.1 组件位置

右上角用户信息旁边

### 3.2 组件样式

```
┌──────────────────────┐
│ [店铺图标] 星巴克总部 ▼│
└──────────────────────┘
```

点击后展开下拉菜单：

```
┌──────────────────────┐
│ ✓ 星巴克总部         │
│   星巴克朝阳门店     │
│   星巴克海淀门店     │
└──────────────────────┘
```

### 3.3 功能说明

**显示逻辑：**
- 显示当前选中的店铺名称
- 如果用户只有一个店铺，不显示下拉箭头
- 如果用户有多个店铺，显示下拉箭头

**切换逻辑：**
1. 点击组件，展开下拉菜单
2. 显示用户可管理的所有店铺列表
3. 当前店铺前显示 ✓ 标记
4. 点击其他店铺，调用切换接口
5. 切换成功后，刷新页面数据
6. 更新组件显示的店铺名称

**接口调用：**
- 初始化：调用 `/user-shop/my-shops` 获取店铺列表
- 切换：调用 `/user-shop/switch` 切换店铺

---

## 四、店铺树形视图页面

### 4.1 页面路径

`/shop/tree`

### 4.2 权限要求

总部管理员可访问

### 4.3 页面布局

```
┌─────────────────────────────────────────────────────┐
│ 店铺树形视图                                          │
├─────────────────────────────────────────────────────┤
│ ▼ 星巴克总部 (SHOP20250120001)                       │
│   ├─ 星巴克朝阳门店 (SHOP20250120002)                │
│   ├─ 星巴克海淀门店 (SHOP20250120003)                │
│   └─ 星巴克西城门店 (SHOP20250120004)                │
└─────────────────────────────────────────────────────┘
```

### 4.4 功能说明

**树形展示：**
- 使用 Ant Design 的 Tree 组件
- 总部为根节点
- 分店为子节点
- 支持展开/收起

**节点信息：**
- 店铺名称
- 店铺编码
- 店铺状态（营业/停业）

**节点操作：**
- 点击节点，显示店铺详情
- 右键菜单：查看、编辑、删除

**接口调用：**
- 调用 `/shop/tree` 获取树形数据

---

## 五、组件设计

### 5.1 ShopSelector 组件

**组件路径：** `src/components/ShopSelector/index.tsx`

**功能：** 店铺切换下拉选择器

**Props：**
```typescript
interface ShopSelectorProps {
  currentShopId: number;
  onShopChange: (shopId: number) => void;
}
```

**使用示例：**
```tsx
<ShopSelector
  currentShopId={currentShopId}
  onShopChange={(shopId) => {
    // 切换店铺逻辑
  }}
/>
```

---

### 5.2 ShopModal 组件

**组件路径：** `src/pages/shop/list/components/ShopModal.tsx`

**功能：** 店铺新增/编辑弹窗

**Props：**
```typescript
interface ShopModalProps {
  visible: boolean;
  current?: API.Shop;
  onCancel: () => void;
  onSuccess: () => void;
}
```

---

## 六、路由配置

### 6.1 路由定义

**文件路径：** `config/routes.ts`

```typescript
{
  path: '/shop',
  name: 'shop',
  icon: 'shop',
  routes: [
    {
      path: '/shop/list',
      name: 'list',
      component: './shop/list',
    },
    {
      path: '/shop/tree',
      name: 'tree',
      component: './shop/tree',
      access: 'canShopTree',
    },
  ],
}
```

---

### 6.2 国际化配置

**文件路径：** `src/locales/zh-CN/menu.ts`

```typescript
export default {
  'menu.shop': '店铺管理',
  'menu.shop.list': '店铺列表',
  'menu.shop.tree': '店铺树形视图',
};
```

---

## 七、状态管理

### 7.1 CurrentShop Model

**文件路径：** `src/models/currentShop.ts`

```typescript
import { useState } from 'react';

export default () => {
  const [currentShopId, setCurrentShopId] = useState<number>();
  const [currentShop, setCurrentShop] = useState<API.Shop>();

  return {
    currentShopId,
    currentShop,
    setCurrentShopId,
    setCurrentShop,
  };
};
```

**使用示例：**
```typescript
const { currentShopId, setCurrentShopId } = useModel('currentShop');
```

---

## 八、开发规范

### 8.1 命名规范

**文件命名：**
- 组件文件：大驼峰命名，例如：`ShopModal.tsx`
- 页面文件：小写+连字符，例如：`tenant-list.tsx`
- 工具文件：小驼峰命名，例如：`formatUtils.ts`

**变量命名：**
- 组件名：大驼峰，例如：`ShopModal`
- 变量名：小驼峰，例如：`currentShopId`
- 常量名：全大写+下划线，例如：`MAX_PAGE_SIZE`

### 8.2 代码规范

- 使用 TypeScript 严格模式
- 使用 ESLint 进行代码检查
- 使用 Prettier 进行代码格式化
- 组件必须有 Props 类型定义
- 接口调用必须有错误处理

---

## 九、总结

本文档详细描述了店铺模块的前端页面设计，包括：
- 店铺管理页面
- 店铺切换组件
- 店铺树形视图页面

所有页面均基于 Ant Design Pro 设计规范，确保与现有系统风格一致。
